# Telegram Bot Project

## Быстрый старт

### Команды для запуска проекта

```powershell
# Установить политику выполнения скриптов PowerShell
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser

# Активировать виртуальное окружение
.venv\Scripts\Activate.ps1

# Запустить сервис кэширования Google Sheets
python -m telegram_bot.services.sheets_cache
python -m telegram_bot.services.sheets_cache --force-reload


---

## Описание проекта

Этот проект представляет собой Telegram-бота, который интегрируется с Google Sheets и базой данных PostgreSQL для управления пользователями и предоставления информации. Бот поддерживает авторизацию пользователей, обработку команд, а также работу с текстовыми блоками и логированием.

---

## Основные функции

### 1. Авторизация пользователей
- Проверка пользователей через Google Sheets и базу данных PostgreSQL.
- Поддержка ролей пользователей: `admin`, `consultant`, `operator`.
- Роли определяются из таблиц и файла `telegram_bot/services/fixed_roles.json`.

### 2. Работа с текстовыми блоками
- Использование текстовых шаблонов для сообщений, таких как приветствие (`welcome.md`) и информация о парке (`about_park.md`).
- Динамическая подстановка данных в шаблоны через функцию `render_welcome`.

### 3. Интеграция с Google Sheets
- Загрузка данных из Google Sheets через API.
- Кэширование данных для повышения производительности.

### 4. Работа с базой данных
- Используется PostgreSQL для хранения данных о пользователях и их ролях.
- Синхронизация данных из Google Sheets в базу данных.

### 5. Обработка команд
- `/start`: Проверка авторизации пользователя и отправка приветственного сообщения.
- Другие команды могут быть добавлены в будущем.

### 6. Логирование
- Логирование событий и ошибок через кастомный сервис.

---

## Установка и настройка

### 1. Клонирование репозитория
```bash
git clone https://github.com/your-repo/telegram-bot.git
cd telegram-bot
```

### 2. Установка зависимостей
Создайте виртуальное окружение и установите зависимости:
```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

### 3. Настройка переменных окружения
Создайте файл `.env` в корне проекта и добавьте следующие переменные:
```
TELEGRAM_TOKEN=your_telegram_bot_token
GOOGLE_SHEETS_CREDENTIALS=path_to_google_credentials.json
DATABASE_URL=postgresql://user:password@localhost:5432/db_name
```

### 4. Настройка Google Sheets
- Создайте Google Service Account и скачайте файл `credentials.json`.
- Укажите путь к этому файлу в переменной `GOOGLE_SHEETS_CREDENTIALS`.

### 5. Запуск бота
```bash
python -m telegram_bot.main
```

---

## Структура проекта

```
telegram_bot/
│
├── domain/
│   ├── text_blocks/         # Текстовые шаблоны
│   └── models/              # Модели данных
│
├── handlers/                # Обработчики команд
│
├── services/                # Сервисы для работы с API, БД и логами
│
├── main.py                  # Точка входа в приложение
└── config.py                # Конфигурация проекта
```

---

## Тестирование

### Запуск тестов
Если вы добавите тесты, их можно запускать с помощью `pytest`:
```bash
pytest
```

---

## Возможности для улучшения

1. Добавить больше обработчиков команд.
2. Реализовать обработку ошибок при работе с базой данных и Google Sheets.
3. Написать тесты для ключевых функций.
4. Улучшить производительность за счёт оптимизации запросов.

---

## Лицензия

Этот проект распространяется под лицензией MIT. Подробнее см. в файле `LICENSE`.